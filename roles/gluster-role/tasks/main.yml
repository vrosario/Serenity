---
- name: Checking Gluster packages are installed
  become: true
  yum:
    name: "{{ packages }}"
  vars:
    packages:
      - centos-release-gluster
      - glusterfs 
      - glusterfs-cli 
      - glusterfs-libs 
      - glusterfs-server

# Filesystem creation tasks
- name: Create xfs filesystem
  become: true
  filesystem:
    fstype: xfs
    dev: "{{item}}" 
  with_items:
    - "/dev/sdb"
- name: Create directory to mount filesystem on
  become: true
  file:
    path: "{{item}}" 
    state: directory
  with_items:
    - "/data/openshift"
- name: Mount filesystem
  become: true
  mount:
    path: "/data/openshift"
    src: /dev/sdb
    fstype: xfs
    opts: defaults
    state: present

- name: Create Gluster cluster
  become: true
  gather_facts: false

  vars:
    # gluster volume
    gluster_cluster_hosts:
      - os1
      - os2 
      - os3
    gluster_cluster_volume: openshift_vol
    gluster_cluster_transport: 'tcp'
    gluster_cluster_force: 'yes'
    gluster_cluster_bricks: '/data/openshift'

    # variables to create specific type of the volume
    gluster_cluster_replica_count: 3
    gluster_cluster_arbiter_count: 1

    # variables to set specific volume options
    gluster_cluster_options: 'performance.cache-size:256MB'

  roles:
    - gluster.cluster
