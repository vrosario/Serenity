---
- name: Stop and disable firewalld
  become: true
  service:
    name: firewalld
    state: stopped
    enabled: False

- name: Install EPEL repository
  become: true
  yum: 
    name: epel-release
    state: present
####

# - name: Check if Origin Testing repo is already configured.
#   stat: 
#     path: "/etc/yum.repos.d/epel.repo"
#   register: origin_repofile_result

# - name: Install Origin Testing repo.
#   yum:
#     name: "https://cbs.centos.org/repos/paas7-openshift-origin311-testing/x86_64/os/"
#     state: present
#   register: result
#   until: 'result.rc == 0'
#   retries: 5
#   delay: 10
#   when: not origin_repofile_result.stat.exists

# - name: Import Origin Testing GPG key.
#   rpm_key:
#     key: "/etc/pki/rpm-gpg/RPM-GPG-KEY-ORIGIN-311ribution_major_version }}"
#     state: present
#   when: not origin_repofile_result.stat.exists
#   ignore_errors: "{{ ansible_check_mode }}"


####
# - name: Add Origin RPMs repository
#   become: true
#   yum_repository:
#     name: Origin RPMs
#     description: Openshift Origin RPMs
#     baseurl: https://storage.googleapis.com/origin-ci-test/logs/test_branch_origin_extended_conformance_gce/3628/artifacts/rpms

- name: Upgrade all packages
  become: true
  yum:
    name: '*'
    state: latest

- name: Disable SELinux
  become: true
  selinux:
    state: disabled
  notify: Restart server

- name: Install common packages
  become: true
  yum:
    name: "{{ packages }}"
  vars:
    packages:
      - vim
      - tmux
      - wget 
      - git 
      - net-tools 
      - bind-utils 
      - yum-utils 
      - iptables-services 
      - bridge-utils 
      - bash-completion 
      - kexec-tools 
      - sos 
      - psacct
      - docker-1.13.1
      - glusterfs-fuse
      - centos-release-openshift-origin310
# - name: Uninstall Origin 3.11
#   become: true
#   yum:
#     name: "centos-release-openshift-origin311"
#     state: removed

